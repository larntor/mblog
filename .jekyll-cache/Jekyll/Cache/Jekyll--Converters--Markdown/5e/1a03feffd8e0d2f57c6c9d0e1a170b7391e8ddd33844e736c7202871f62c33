I"ò<p>win10
vs2015
openssl 1.0.2h</p>

<!--more-->
<p>####æ­¥éª¤</p>

<ul>
  <li>msys ç”Ÿæˆmakefile</li>
  <li>nmake -f makefileç¼–è¯‘</li>
</ul>

<p>####å‡†å¤‡
md nginx\objs\lib
tar zxf  openssl-1.0.2h.tar.gz -C nginx/objs/lib
tar xf  zlib-1.2.8.tar.gz -C nginx/objs/lib
tar xf  pcre-8.39.tar.gz -C nginx/objs/lib</p>

<p>C:\RailsInstaller\DevKit\msys.bat</p>

<p>nasm</p>

<p>æºç è§£å‹nginx\objs\lib</p>

<p>####nasmç¼–è¯‘openssl</p>

<p>auto\lib\openssl\makefile.msvc
æœ€åä¸‰è¡Œæ›¿æ¢æˆ</p>

<p>ms\do_nasm
nmake -f ms\nt.mak
nmake -f ms\nt.mak install</p>

<p>ä¸ç”¨nasmç¼–è¯‘openssl 1.0.2fä¼š
tmp32\sha1-586.asm(1432) : error A2070:invalid instruction operands</p>

<p>ç›´æ¥ç¼–è¯‘opensslæ˜¯</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	perl Configure VC-WIN32
	ms\do_nasm.bat
	nmake -f ms\nt.mak
</code></pre></div></div>
<p>è¾“å‡ºåœ¨ out32 ç›®å½•</p>

<p>mkdir objs
mkdir objs\lib
cd objs\lib
mklink /D pcre ......\pcre-8.39
mklink /D zlib ......\zlib-1.2.8
mklink /D openssl ......\openssl-1.0.2h</p>

<p>####ç”Ÿæˆmakefile
msys.bat</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>auto/configure --with-cc=cl   --with-cc-opt="-D FD_SETSIZE=4096 " --builddir=objs \
--conf-path=conf/nginx.conf --pid-path=logs/nginx.pid \
--http-log-path=logs/access.log --error-log-path=logs/error.log \
--sbin-path=nginx.exe --http-client-body-temp-path=temp/client_body_temp \
--http-proxy-temp-path=temp/proxy_temp \
--http-fastcgi-temp-path=temp/fastcgi_temp \
--with-pcre=objs/lib/pcre \
--with-zlib=objs/lib/zlib \
--with-openssl=objs/lib/openssl \
--with-select_module \
--with-http_ssl_module \
--with-http_v2_module \
--with-http_gunzip_module \
--with-http_gzip_static_module
</code></pre></div></div>

<p>####ç¼–è¯‘</p>

<p>nginx\auto\lib\openssl\makefile.msvcï¼Œå°† no-shared æ”¹ä¸º no-asm</p>

<p>cmd run
â€œC:\Program Files (x86)\Microsoft Visual Studio 14.0\VC\vcvarsall.batâ€</p>

<p>nmake -f Makefile</p>

<pre>
nginx version: nginx/1.9.12
built by cl
built with OpenSSL 1.0.2f  28 Jan 2016
TLS SNI support enabled
configure arguments: --with-cc=cl --with-cc-opt='-D FD_SETSIZE=4096' --builddir=objs --prefix= --conf-path=conf/nginx.conf --pid-path=logs/nginx.pid --http-log-path=logs/access.log --error-log-path=logs/error.log --sbin-path=nginx.exe --http-client-body-temp-path=temp/client_body_temp --http-proxy-temp-path=temp/proxy_temp --http-fastcgi-temp-path=temp/fastcgi_temp --with-pcre=objs/lib/pcre-8.32 --with-zlib=objs/lib/zlib-1.2.7 --with-openssl=objs/lib/openssl-1.0.2f --with-select_module --with-http_ssl_module --with-http_v2_module
</pre>

<p>åŠ ä¸ªecho-nginx-moduleç©ç©ï¼Œæ³¨æ„å…ˆadd ngx_devel_kit</p>

<p>https://github.com/simpl/ngx_devel_kit.git
https://github.com/openresty/echo-nginx-module.git</p>

<p>â€“add-module=objs/lib/ngx_devel_kit â€“add-module=objs/lib/echo-nginx-module</p>

<p>auto\cc\msvcæŠŠ-Yungx_config.h å»æ‰ï¼Œå¦åˆ™ç¼–è¯‘æŠ¥é”™
windows æ¨¡å—å¼€å‘ä¸­ä¼šé‡åˆ°çš„é—®é¢˜ï¼Œæ¯ä¸ªæºæ–‡ä»¶ç¬¬ä¸€è¡Œä»£ç å¿…é¡»æ·»åŠ  #include â€œngx_config.hâ€* ï¼Œå¦‚æœä¸æƒ³è¿™æ ·åšå°±å§ç¼–è¯‘å‚æ•° *-Yungx_config.h å»æ‰ã€‚</p>

<pre>
#NGX_USE_PCH="-Yungx_config.h -Fp$NGX_OBJS/ngx_config.pch"
NGX_USE_PCH="-Fp$NGX_OBJS/ngx_config.pch"
</pre>
:ET