---
layout: post
title:  C＃ 谁改了我的代码 
category: 技术 
stickie: False
---

本文告诉大家一个特殊的做法，可以修改一个字符串常量

<!--more-->
<!-- csdn -->

我们来写一个简单的程序，把一个常量字符串输出

```csharp
        private const string str = "lindexi";
        static void Main(string[] args)
        {
            Foo();
            Console.WriteLine(str);
        }
```

其中的 Foo 是其他的函数，大家可以猜到输出是 lindexi ，但是，实际上把Foo调用函数添加之后，输出是 Lindexi 被大写了。那么这时 Foo 做了什么？

Foo 做的就是
[C＃ 字符串首字符大写](https://lindexi.oschina.io/lindexi/post/C-%E5%AD%97%E7%AC%A6%E4%B8%B2%E9%A6%96%E5%AD%97%E7%AC%A6%E5%A4%A7%E5%86%99.html )

```csharp
        public static unsafe void Foo()
        {
            fixed (char* ptr = str)
            {
                *ptr = char.ToUpper(*ptr);
            }
        }
```

虽然出现了问题，但是找到问题很简单，如果这时需要做一个安全有关的。让别人看到源代码也不知道怎么使用，那么就可以使用这个科技，下面就是显示技术的时候

我把 Foo 做一些修改，把 str 变量去掉，这样大家就难以通过搜索变量引用找到了这个函数

```csharp
        public static unsafe void Foo()
        {
            fixed (char* ptr = "lindexi")
            {
                *ptr = char.ToUpper(*ptr);
            }
        }
```

这时输出 str 结果是 Lindexi ，因为编译器把相同的常量视为同一个地址，这样修改一个地方的常量就可以修改其他地方的。所以可以写的是一个常量，实际上这个常量在另一个地方被修改。

这个方法是不推荐在一般情况使用，因为谁都不能说没有其他地方使用一样的字符串。

  
